<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Flappy Pig</title>
<style>
  body {
    margin: 0;
    overflow: hidden;
    background: linear-gradient(#aeefff, #ffffff);
    font-family: 'Comic Sans MS', cursive;
  }
  canvas {
    display: block;
    margin: auto;
    background: transparent;
  }
  #overlay {
    position: absolute;
    top: 0; left: 0; right: 0; bottom: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    background: rgba(255, 255, 255, 0.8);
    font-family: 'Comic Sans MS', cursive;
  }
  button {
    padding: 10px 20px;
    background: pink;
    border: none;
    border-radius: 10px;
    font-size: 18px;
    cursor: pointer;
  }
  input {
    padding: 8px;
    font-size: 16px;
    margin-bottom: 10px;
    border-radius: 5px;
    border: 1px solid #ccc;
  }
  ul {
    list-style: none;
    padding: 0;
    margin-top: 15px;
    text-align: center;
  }
  li {
    font-size: 16px;
  }
</style>
</head>
<body>
<div id="overlay">
  <input type="text" id="playerName" placeholder="Enter your name">
  <button onclick="startGame()">Start Game</button>
  <h3>Leaderboard</h3>
  <ul id="leaderboard"></ul>
</div>
<canvas id="gameCanvas" width="400" height="600"></canvas>
<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

let pig, gravity, lift, pipes, score, gameOver, playerName;
let leaderboard = JSON.parse(localStorage.getItem('flappyPigScores') || '[]');

// Draw sparkle background
function drawSparkles() {
  for (let i = 0; i < 50; i++) {
    ctx.fillStyle = 'white';
    ctx.beginPath();
    ctx.arc(Math.random() * canvas.width, Math.random() * canvas.height, Math.random() * 2, 0, Math.PI * 2);
    ctx.fill();
  }
}

// Pig with wings
function drawPig(x, y) {
  ctx.fillStyle = 'pink';
  ctx.beginPath();
  ctx.arc(x, y, 15, 0, Math.PI * 2); // body
  ctx.fill();

  ctx.fillStyle = '#ffb6c1';
  ctx.beginPath();
  ctx.arc(x + 15, y - 10, 8, 0, Math.PI * 2); // head
  ctx.fill();

  ctx.fillStyle = 'white';
  ctx.beginPath();
  ctx.moveTo(x - 10, y);
  ctx.lineTo(x - 25, y - 10);
  ctx.lineTo(x - 25, y + 10);
  ctx.closePath();
  ctx.fill(); // wing
}

// Pipe
function drawPipe(pipe) {
  ctx.fillStyle = 'green';
  ctx.fillRect(pipe.x, 0, pipe.width, pipe.top);
  ctx.fillRect(pipe.x, canvas.height - pipe.bottom, pipe.width, pipe.bottom);
}

// Start game
function startGame() {
  playerName = document.getElementById('playerName').value || 'Player';
  document.getElementById('overlay').style.display = 'none';
  resetGame();
  requestAnimationFrame(gameLoop);
}

function resetGame() {
  pig = { x: 80, y: canvas.height / 2, velocity: 0 };
  gravity = 0.4;
  lift = -8;
  pipes = [];
  score = 0;
  gameOver = false;
  spawnPipe();
}

function spawnPipe() {
  const gap = 140;
  const top = Math.random() * (canvas.height - gap - 100) + 50;
  pipes.push({ x: canvas.width, top: top, bottom: canvas.height - top - gap, width: 40 });
}

function update() {
  pig.velocity += gravity;
  pig.y += pig.velocity;

  if (pig.y + 15 > canvas.height) gameOver = true;
  if (pig.y - 15 < 0) pig.y = 15;

  for (let i = pipes.length - 1; i >= 0; i--) {
    let pipe = pipes[i];
    pipe.x -= 2;
    if (pipe.x + pipe.width < 0) {
      pipes.splice(i, 1);
      score++;
      spawnPipe();
    }
    // collision
    if (pig.x + 15 > pipe.x && pig.x - 15 < pipe.x + pipe.width &&
       (pig.y - 15 < pipe.top || pig.y + 15 > canvas.height - pipe.bottom)) {
      gameOver = true;
    }
  }
}

function draw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  drawSparkles();

  // Clouds
  ctx.fillStyle = 'white';
  ctx.beginPath();
  ctx.arc(60, 60, 20, 0, Math.PI * 2);
  ctx.arc(80, 60, 25, 0, Math.PI * 2);
  ctx.arc(100, 60, 20, 0, Math.PI * 2);
  ctx.fill();

  pipes.forEach(drawPipe);
  drawPig(pig.x, pig.y);

  ctx.fillStyle = 'black';
  ctx.font = '20px Comic Sans MS';
  ctx.fillText('Score: ' + score, 10, 30);

  ctx.fillStyle = 'pink';
  ctx.font = '16px Comic Sans MS';
  ctx.fillText('loise cute :P', canvas.width / 2 - 40, canvas.height - 10);
}

function gameLoop() {
  if (!gameOver) {
    update();
    draw();
    requestAnimationFrame(gameLoop);
  } else {
    saveScore();
    showGameOver();
  }
}

function saveScore() {
  leaderboard.push({ name: playerName, score: score });
  leaderboard.sort((a, b) => b.score - a.score);
  leaderboard = leaderboard.slice(0, 5);
  localStorage.setItem('flappyPigScores', JSON.stringify(leaderboard));
}

function showGameOver() {
  ctx.fillStyle = 'rgba(255,255,255,0.7)';
  ctx.fillRect(0, 0, canvas.width, canvas.height);
  ctx.fillStyle = 'black';
  ctx.font = '30px Comic Sans MS';
  ctx.fillText('Game Over', canvas.width / 2 - 70, canvas.height / 2 - 20);

  let retryBtn = document.createElement('button');
  retryBtn.textContent = 'Retry';
  retryBtn.style.position = 'absolute';
  retryBtn.style.left = '50%';
  retryBtn.style.top = '60%';
  retryBtn.style.transform = 'translate(-50%, -50%)';
  retryBtn.onclick = () => {
    retryBtn.remove();
    resetGame();
    requestAnimationFrame(gameLoop);
  };
  document.body.appendChild(retryBtn);
}

function renderLeaderboard() {
  let lb = document.getElementById('leaderboard');
  lb.innerHTML = '';
  leaderboard.forEach(e => {
    let li = document.createElement('li');
    li.textContent = `${e.name}: ${e.score}`;
    lb.appendChild(li);
  });
}

renderLeaderboard();

window.addEventListener('keydown', () => pig.velocity = lift);
canvas.addEventListener('click', () => pig.velocity = lift);

</script>
</body>
</html>
